name: Docker Image CI

on:
  push:
    branches: [ "Playerbot" ]
  pull_request:
    branches: [ "Playerbot" ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: pwd && ls -l 
      run: pwd && ls -l 
    #gitag
    - name: make gitag
      run: |
       echo '##[set-env name=GITAG;]$(git log --pretty=format:"%h" -1)' >> $GITHUB_ENV
      working-directory: ./
    #mod-playerbots
    - name: get mod-playerbots
      uses: sudosubin/git-clone-action@v1.0.1
      with:
        repository: liyunfan1223/mod-playerbots
        ref: master
        path: modules/mod-playerbots
    - name: make gitag_mod_playerbots
      run: |
       export GITAG_MOD_PLAYERBOTS=bot$(git log --pretty=format:"%h" -1)
      working-directory: modules/mod-playerbots
    #mod-ah-bot
    - name: get mod-ah-bot
      uses: sudosubin/git-clone-action@v1.0.1
      with:
        repository: azerothcore/mod-ah-bot
        path: modules/mod-ah-bot
    - name: make gitag_mod_ah_bot
      run: |
       export GITAG_MOD_AH_BOT=ah$(git log --pretty=format:"%h" -1)
      working-directory: modules/mod-ah-bot
    #mod-solo-lfg
    - name: get mod-solo-lfg
      uses: sudosubin/git-clone-action@v1.0.1
      with:
        repository: azerothcore/mod-solo-lfg
        path: modules/mod-solo-lfg
    - name: make gitag_mod_solo_lfg
      run: |
       export GITAG_MOD_SOLO_LFG=lfg$(git log --pretty=format:"%h" -1)
      working-directory: modules/mod-solo-lfg
    #mod-1v1-arena
    - name: get mod-1v1-arena
      uses: sudosubin/git-clone-action@v1.0.1
      with:
        repository: azerothcore/mod-1v1-arena
        path: modules/mod-1v1-arena
    - name: make gitag_mod_1v1_arena
      run: |
       export GITAG_MOD_1V1_ARENA=1v1$(git log --pretty=format:"%h" -1)
      working-directory: modules/mod-1v1-arena
    #mod-eluna
    - name: get mod-eluna
      uses: sudosubin/git-clone-action@v1.0.1
      with:
        repository: azerothcore/mod-eluna
        path: modules/mod-eluna
    - name: make gitag_mod_eluna
      run: |
       export GITAG_MOD_ELUNA=lua$(git log --pretty=format:"%h" -1)
      working-directory: modules/mod-eluna
    #show tags
    - name: show tags
      run: |
       echo $GITAG-$GITAG_MOD_PLAYERBOTS-$GITAG_MOD_AH_BOT-$GITAG_MOD_SOLO_LFG-$GITAG_MOD_1V1_ARENA-$GITAG_MOD_ELUNA
